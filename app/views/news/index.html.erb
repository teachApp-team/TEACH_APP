<%= render partial: 'share/header' %>
<div style="padding: 76px 0 0 0"></div>

<section class="news_field_background">

      <div class="tabs">
        <input id="all" type="radio" name="tab_item" checked>
        <label class="tab_item" for="all">学習履歴</label>
        <input id="programming" type="radio" name="tab_item">
        <label class="tab_item" for="programming">質問</label>
        <input id="design" type="radio" name="tab_item">
        <label class="tab_item" for="design">単語テスト</label>

        <div class="tab_content" id="all_content">
          <div class="tab_content_description">
            <% @lm.each do |l| %>
              <% if l.class.name == "LearningHistory" %>
                <div class="stu_card">
                  <div class="stu_card_info" style="margin-bottom: 20px;">
                    <div class="stu_card_info_img">
                      <% if l.student.image.present? %>
                        <%= image_tag l.student.image.url, class: "stu_card_info_img_self" %>
                      <% else %>
                        <p class="stu_card_info_img_self" style="font-size: 14px;">画像<br>なし</p>
                      <% end %>
                    </div>
                  </div>
                  <div class="stu_card_info_name">
                    <% if l.student.id == @current_student&.id %>
                      <h5>
                        <%= l.student.full_name %>君
                        <%= link_to "編集", "/news_field/#{l.id}/edit", style: "color: tomato;margin-left: 40px;font-size:13px;" %>
                        <%= link_to "削除", "/destroy_lh/#{l.id}", style: "color: tomato;margin-left: 20px;font-size:13px;", method: :delete, data: { confirm: '削除しますか？' } %>
                      </h5>
                    <% else %>
                      <h5><%= link_to l.student.full_name, "/each_student/#{l.student.id}", method: :get %></h5>
                    <% end %>
                  </div>
                  <div class="stu_card_info_time_ago">
                    <p style="margin-bottom: 5px;"><%= l.created_at.to_s(:datetime_jp) %></p>
                  </div>
                  <%= render partial: 'share/student-history', locals: {variable: l} %>
                </div>
              <% elsif l.class.name == "Message" %>
                <div class="teacher_card">
                  <div class="teacher_card_info">
                    <div class="teacher_card_info_img">
                      <% if l.teacher.present? %>
                        <% if l.teacher.image.present? %>
                          <%=image_tag l.teacher.image.url , class: "teacher_card_info_img_self" %>
                        <% else %>
                          <p class="stu_card_info_img_self" style="font-size: 14px;">画像<br>なし</p>
                        <% end %>
                      <% else %>
                        <div></div>
                      <% end %>
                    </div>
                    <div class="teacher_card_info_name">
                      <% if l.teacher.id == @current_teacher&.id %>
                        <h5>
                          <%= l.teacher.full_name %>先生
                            <%= link_to "削除", "/messages/#{l.id}", method: :delete, style: "color: tomato;margin-left: 40px;font-size:13px;", data: { confirm: '削除しますか？' } %>
                        </h5>
                      <% else %>
                        <h5><%= l.teacher.full_name %>先生</h5>
                      <% end %>
                    </div>
                    <div class="teacher_card_info_time_ago">
                      <p><%= l.created_at.to_s(:datetime_jp) %></p>
                    </div>
                  </div>
                  <div class="balloon_teacher">
                    <div class="teacher_card_comment">
                      <% if @current_student.present? %>
                        <p><%= l.comment %></p>
                      <% else %>
                        <p style="font-size: 11px;">To: <%= l.student.full_name %>君</p>
                        <p><%= l.comment %></p>
                      <% end %>
                    </div>
                  </div>
                </div>
              <% end %>
            <% end %>
          </div>
        </div>

        <div class="tab_content" id="programming_content">
          <div class="tab_content_description">
            <% @questions.each do |q| %>
              <div class="stu_card">
                <div class="stu_card_info" style="margin-bottom: 20px;">
                  <div class="stu_card_info_img">
                    <% if q.student.image.present? %>
                      <%= image_tag q.student.image.url, class: "stu_card_info_img_self" %>
                    <% else %>
                      <p class="stu_card_info_img_self" style="font-size: 14px;">画像<br>なし</p>
                    <% end %>
                  </div>
                  <div class="stu_card_info_name">
                    <h5>
                      <%= q.student.full_name %>君
                      <% if @current_student.present? %>
                        <%= link_to "削除", "/destroy_q/#{q.id}", style: "color: tomato;margin-left: 20px;font-size:13px;", method: :delete, data: { confirm: '削除しますか？' } %>
                      <% end %>
                    </h5>
                  </div>
                  <div class="stu_card_info_time_ago">
                    <p style="margin-bottom: 5px;"><%= q.created_at.to_s(:datetime_jp) %></p>
                  </div>
                </div>
                <div class="balloon" style="margin-top: 0px;">
                  <div class="stu_card_content">
                    <div class="stu_card_content_subject">
                        <p class="stu_card_content_question_circle" style="margin-bottom: 5px">質</p>
                    </div>
                    <div class="stu_card_content_text" style="padding: 0px;padding-left: 5px;">
                      <span style="font-size: 12px;"><%=q.category %></span>
                      <% if q.image.present? %>
                        <div style="font-size: 12px;"><%= link_to "画像を表示", q.image.url %></div>
                      <% else %>
                        <div style="font-size: 12px;">画像なし</div>
                      <% end %>
                    </div>
                  </div>
                  <div class="stu_card_comment" style="margin-top: 5px;">
                    <p style="font-size: 12px;margin-bottom: 5px;"><%=q.content %></p>
                  </div>
                </div>
                <% if q.replies.length == 0 %>
                    <%= link_to "返信する", "replies/#{q.id}/new", method: :get, style: "color: tomato;color:blue;" %>
                <% end %>
                <% q.replies.each_with_index do |r, i| %>
                  <div class="teacher_card" style="border-left:solid 1px; padding-right: 0px;padding-top: 10px;padding-bottom: 0px;margin:0px">
                    <div class="teacher_card_info">
                      <div class="teacher_card_info_img">
                        <% if r.which == "student" %>
                          <% if r.student.image.present? %>
                            <%= image_tag r.student.image.url, class: "stu_card_info_img_self" %>
                          <% else %>
                            <p class="stu_card_info_img_self" style="font-size: 14px;">画像<br>なし</p>
                          <% end %>
                        <% else %>
                          <% if r.teacher.image.present? %>
                            <%= image_tag r.teacher.image.url, class: "stu_card_info_img_self" %>
                          <% else %>
                            <p class="stu_card_info_img_self" style="font-size: 14px;">画像<br>なし</p>
                          <% end %>
                        <% end %>
                      </div>
                      <div class="teacher_card_info_name">
                        <% if r.which == "student" %>
                          <h5>
                            <%=r.student.full_name %>
                          <% if @current_student.present? %>
                            <%= link_to "削除", "/destroy_r/#{r.id}", style: "color: tomato;margin-left: 20px;font-size:13px;", method: :delete, data: { confirm: '削除しますか？' } %>
                          <% end %>
                          </h5>   
                        <% else %>
                          <h5>
                            <%=r.teacher.full_name %>
                            <% if @current_teacher.present? %>
                              <%= link_to "削除", "/destroy_r/#{r.id}", style: "color: tomato;margin-left: 20px;font-size:13px;", method: :delete, data: { confirm: '削除しますか？' }  %>
                            <% end %>
                          </h5>
                        <% end %>
                      </div>
                      <div class="teacher_card_info_time_ago">
                        <p><%= r.created_at.to_s(:datetime_jp)%></p>
                      </div>
                    </div>
                    <% if r.which == "student" %>
                      <div class="balloon_student" style="margin-bottom: 0px;">
                        <div class="teacher_card_comment">
                          <% if r.image.present? %>
                            <div style="font-size: 12px;"><%= link_to "画像を表示", r.image.url %></div>
                          <% else %>
                            <div style="font-size: 12px;">画像なし</div>
                          <% end %>
                          <p style="font-size: 11px;">To: <%=r.teacher.full_name %></p>
                          <p><%=r.content %></p>
                        </div>
                      </div>
                    <% else %>
                      <div class="balloon_teacher" style="margin-bottom: 0px;">
                        <div class="teacher_card_comment">
                          <% if r.image.present? %>
                            <div style="font-size: 12px;"><%= link_to "画像を表示", r.image.url %></div>
                          <% else %>
                            <div style="font-size: 12px;">画像なし</div>
                          <% end %>
                          <p style="font-size: 11px;">To: <%=r.student.full_name %></p>
                          <p><%=r.content %></p>
                        </div>
                      </div>
                    <% end %>
                    <% if q.replies.length == i + 1 %>
                      <div style = "margin-top: 10px;">
                        <%= link_to "返信する", "replies/#{e.id}/new", method: :get, style: "color: blue;" %>
                      </div>
                    <% end %>
                  </div>
                <% end %>
              </div>
            <% end %>
          </div>
        </div>
        <div class="tab_content" id="design_content">
          <div class="tab_content_description">
            <% @t.each do |t| %>
              <div class="stu_card">
                <div class="stu_card_info" style="margin-bottom: 20px;">
                  <div class="stu_card_info_img">
                    <% if t.results.last.student.image.present? %>
                      <%= image_tag t.results.last.student.image.url, class: "stu_card_info_img_self" %>
                    <% else %>
                      <p class="stu_card_info_img_self" style="font-size: 14px;">画像<br>なし</p>
                    <% end %>
                  </div>
                  <div class="stu_card_info_name">
                    <h5>
                      <%= t.results.last.student.full_name %>
                    </h5>
                  </div>
                  <div class="stu_card_info_time_ago">
                    <p style="margin-bottom: 5px;">
                      <%= t.created_at.to_s(:datetime_jp) %>
                    </p>
                  </div>
                </div>
                <% if t.class.name == "WordTest" %>
                  <div class="balloon" style="margin-top: 0px;">
                    <div class="stu_card_content">
                      <div class="stu_card_content_subject">
                        <p class="stu_card_content_words_circle" style="margin-bottom: 5px">単</p>
                      </div>
                      <div class="stu_card_words" style="padding-left: 10px;">
                        <p style="font-size: 12px;margin-bottom: 2px;">
                          教材： <%= t.results.last.word.wordbook.name %>
                        </p>
                        <div>
                          <p style="font-size: 12px;margin-bottom: 5px;">
                            レベル: <%= t.results.last.word.level %>
                          </p>
                        </div>
                      </div>
                    </div>
                    <div style="text-align: center;padding-right: 20px;">
                      <span style="font-size: 12px;margin-bottom: 2px;margin-right: 5px;">
                        <%= t.results.length %>問中
                      </span>
                      <span style="font-size: 17px;margin-bottom: 5px;">
                        <%= t.results.corrects_count %>問正解
                      </span>
                    </div>
                    <div class="stu_card_content_words" style="text-align: left;">
                      <button class="btn btn-primary"
                      data-toggle="collapse"
                      data-target="#example-<%= t.id %>"
                      aria-expand="false"
                      aria-controls="example-<%= t.id %>">回答の詳細はこちら</button>
                      <div class="collapse" id="example-<%= t.id %>">
                        <div class="card card-body" style="padding: 10px;">
                          <table class="table table-bordered" style="margin-bottom: 0px;">
                            <thead>
                              <tr>
                                <th scope="col"><p style="font-size: 8px; margin-bottom: 0px;">No.</p></th>
                                <th scope="col" style="font-size: 12px">英単語</th>
                                <th scope="col" style="font-size: 12px">日本語</th>
                                <th class="wrong_count" scope="col" style="font-size: 5px">間違えた回数</th>
                              </tr>
                            </thead>
                            <tbody>
                              <% t.results.each_with_index do |r, i| %>
                                <% if r.correct %>
                                  <tr>
                                <% else %>
                                  <tr class= "wrong-correct-word" style="color:red;">
                                <% end %>
                                    <th scope="row" style="font-size: 5px; margin-bottom: 0px;"><%= i+1 %></th>
                                    <td style="font-size: 8px; margin-bottom: 0px;"><%=r.word.english %></td>
                                    <td style="font-size: 8px; margin-bottom: 0px;"><%=r.word.japanese %></td>
                                    <td style="font-size: 8px; text-align: ceneter;"><%=r.word.wrong_count %></td>
                                  </tr> 
                              <% end %>
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </div>
                  </div>
                <% else %>
                  <div class="balloon" style="margin-top: 0px;">
                    <div class="stu_card_content">
                      <div class="stu_card_content_subject">
                          <p class="stu_card_content_words_circle" style="margin-bottom: 5px">単</p>
                      </div>
                      <div class="stu_card_words" style="padding-left: 10px;">
                        古文単語
                        <p style="font-size: 12px;margin-bottom: 2px;">
                          教材： 大学受験古文単語
                        </p>
                      </div>
                    </div>
                    <div style="text-align: center;padding-right: 20px;">
                      <span style="font-size: 12px;margin-bottom: 2px;margin-right: 5px;">
                        <%= t.results.length %>問中
                      </span>
                      <span style="font-size: 17px;margin-bottom: 5px;">
                        <%= t.results.corrects_count %>問正解
                      </span>
                    </div>
                    <div class="stu_card_content_words" style="text-align: left;">
                      <button class="btn btn-primary"
                      data-toggle="collapse"
                      data-target="#example-<%= t.id %>"
                      aria-expand="false"
                      aria-controls="example-<%= t.id %>">回答の詳細はこちら</button>
                      <div class="collapse" id="example-<%= t.id %>">
                        <div class="card card-body" style="padding: 10px;">
                          <table class="table table-bordered" style="margin-bottom: 0px;">
                            <thead>
                              <tr>
                                <th scope="col"><p style="font-size: 12px; margin-bottom: 0px;">No.</p></th>
                                <th scope="col" style="font-size: 12px">古文単語</th>
                                <th scope="col" style="font-size: 12px">漢字</th>
                                <th scope="col" style="font-size: 12px">意味</th>
                                <th class="wrong_count" scope="col" style="font-size: 9px">間違えた回数</th>
                              </tr>
                            </thead>
                            <tbody>
                              <% t.results.each_with_index do |r, i| %>
                              <% if r.correct %>
                                <tr>
                              <% else %>
                                <tr class= "wrong-correct-word" style="color:red;">
                              <% end %>
                                  <th scope="row" style="font-size: 5px; margin-bottom: 0px;"><%= i+1 %></th>
                                  <td style="font-size: 11px; margin-bottom: 0px;"><%=r.old_word.name %></td>
                                  <td style="font-size: 11px; margin-bottom: 0px;"><%=r.old_word.kanji %></td>
                                  <td style="font-size: 11px; margin-bottom: 0px;"><%=r.old_word.meaning %></td>
                                  <td style="font-size: 11px; text-align: ceneter;"><%=r.old_word.wrong_count %></td>
                                </tr> 
                              <% end %>
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </div>
                  </div>
                <% end %>
              </div>
            <% end %>
          </div>
        </div>
        <% if @current_teacher %>
          <div class="new_message_add">
            <a href="/messages/new" class="new_message_add_btn">
              <i class="fas fa-comment message_icon"></i>
            </a>
          </div>
        <% else %>
          <div class="new_question_add">
            <a href="/questions/new" class="new_message_add_btn">
              <i class="far fa-hand-paper question_icon"></i>
              <!-- <i class="fas fa-question question_icon"></i> -->
            </a>
          </div>
          <div class="new_message_add">
            <a href="/new_lh" class="new_message_add_btn">
              <i class="fas fa-pencil-alt message_icon"></i>
            </a>
          </div>
        <% end %>
      </div>
    </section>
    














