<%= render partial: 'share/header' %>
<div style="padding: 76px 0 0 0"></div>

<section class="news_field_background">

<% @news.each do |e| %>
<% if e.class.name == "Question" %>
    <div class="stu_card">
      <div class="stu_card_info" style="margin-bottom: 20px;">
        <div class="stu_card_info_img">
        <% if e.student.image.present? %>
          <%= image_tag e.student.image.url, class: "stu_card_info_img_self" %>
        <% else %>
          <p class="stu_card_info_img_self" style="font-size: 14px;">画像<br>なし</p>
        <% end %>
        </div>
        <div class="stu_card_info_name">
          <h5>
            <%= e.student.full_name %>君
            <% if @current_student.present? %>
              <%= link_to "削除", "/destroy_q/#{e.id}", style: "color: tomato;margin-left: 20px;font-size:13px;", method: :delete, data: { confirm: '削除しますか？' } %>
            <% end %>
          </h5>
        </div>
        <div class="stu_card_info_time_ago">
          <p style="margin-bottom: 5px;"><%= e.created_at.to_s(:datetime_jp) %></p>
        </div>
      </div>
      <div class="balloon" style="margin-top: 0px;">
        <div class="stu_card_content">
          <div class="stu_card_content_subject">
              <p class="stu_card_content_question_circle" style="margin-bottom: 5px">質</p>
          </div>
          <div class="stu_card_content_text" style="padding: 0px;padding-left: 5px;">
            <span style="font-size: 12px;"><%=e.category %></span>
            <% if e.image.present? %>
            <div style="font-size: 12px;"><%= link_to "画像を表示", e.image.url %></div>
            <% else %>
            <div style="font-size: 12px;">画像なし</div>
            <% end %>
          </div>
        </div>
        <div class="stu_card_comment" style="margin-top: 5px;">
          <p style="font-size: 12px;margin-bottom: 5px;"><%=e.content %></p>
        </div>
      </div>
      <% if e.replies.length == 0 %>
          <%= link_to "返信する", "replies/#{e.id}/new", method: :get, style: "color: tomato;color:blue;" %>
      <% end %>

    <% e.replies.each_with_index do |r, i| %>
    <div class="teacher_card" style="border-left:solid 1px; padding-right: 0px;padding-top: 10px;padding-bottom: 0px;margin:0px">
      <div class="teacher_card_info">
        <div class="teacher_card_info_img">
        <% if r.which == "student" %>
          <% if r.student.image.present? %>
            <%= image_tag r.student.image.url, class: "stu_card_info_img_self" %>
          <% else %>
            <p class="stu_card_info_img_self" style="font-size: 14px;">画像<br>なし</p>
          <% end %>
        <% else %>
          <% if r.teacher.image.present? %>
            <%= image_tag r.teacher.image.url, class: "stu_card_info_img_self" %>
          <% else %>
            <p class="stu_card_info_img_self" style="font-size: 14px;">画像<br>なし</p>
          <% end %>
        <% end %>
        </div>
        <div class="teacher_card_info_name">
          <% if r.which == "student" %>
            <h5>
              <%=r.student.full_name %>
            <% if @current_student.present? %>
              <%= link_to "削除", "/destroy_r/#{r.id}", style: "color: tomato;margin-left: 20px;font-size:13px;", method: :delete, data: { confirm: '削除しますか？' } %>
            <% end %>
            </h5>
            
          <% else %>
            <h5>
              <%=r.teacher.full_name %>
            <% if @current_teacher.present? %>
              <%= link_to "削除", "/destroy_r/#{r.id}", style: "color: tomato;margin-left: 20px;font-size:13px;", method: :delete, data: { confirm: '削除しますか？' }  %>
            <% end %>
            </h5>
          <% end %>
        </div>
        <div class="teacher_card_info_time_ago">
          <p><%= r.created_at.to_s(:datetime_jp)%></p>
        </div>
      </div>
      <% if r.which == "student" %>
      <div class="balloon_student" style="margin-bottom: 0px;">
        <div class="teacher_card_comment">
          <% if r.image.present? %>
            <div style="font-size: 12px;"><%= link_to "画像を表示", r.image.url %></div>
          <% else %>
            <div style="font-size: 12px;">画像なし</div>
          <% end %>
          <p style="font-size: 11px;">To: <%=r.teacher.full_name %></p>
          <p><%=r.content %></p>
        </div>
      </div>
      <% else %>
      <div class="balloon_teacher" style="margin-bottom: 0px;">
        <div class="teacher_card_comment">
          <% if r.image.present? %>
            <div style="font-size: 12px;"><%= link_to "画像を表示", r.image.url %></div>
          <% else %>
            <div style="font-size: 12px;">画像なし</div>
          <% end %>
          <p style="font-size: 11px;">To: <%=r.student.full_name %></p>
          <p><%=r.content %></p>
        </div>
      </div>
      <% end %>
      <% if e.replies.length == i + 1 %>
      <div style = "margin-top: 10px;">
        <%= link_to "返信する", "replies/#{e.id}/new", method: :get, style: "color: blue;" %>
      </div>
      <% end %>
  </div>
  <% end %>
</div>


<% elsif e.class.name == "LearningHistory" %>
  <div class="stu_card">
    <div class="stu_card_info" style="margin-bottom: 20px;">
      <div class="stu_card_info_img">
      <% if e.student.image.present? %>
        <%= image_tag e.student.image.url, class: "stu_card_info_img_self" %>
      <% else %>
        <p class="stu_card_info_img_self" style="font-size: 14px;">画像<br>なし</p>
      <% end %>
      </div>
      <div class="stu_card_info_name">
        <% if e.student.id == @current_student&.id %>
          <h5>
            <%= e.student.full_name %>君
            <%= link_to "編集", "/news_field/#{e.id}/edit", style: "color: tomato;margin-left: 40px;font-size:13px;" %>
            <%= link_to "削除", "/destroy_lh/#{e.id}", style: "color: tomato;margin-left: 20px;font-size:13px;", method: :delete, data: { confirm: '削除しますか？' } %>
          </h5>
        <% else %>
          <h5><%= link_to e.student.full_name, "/each_student/#{e.student.id}", method: :get %></h5>
        <% end %>
      </div>
      <div class="stu_card_info_time_ago">
        <p style="margin-bottom: 5px;"><%= e.created_at.to_s(:datetime_jp) %></p>
      </div>
    </div>
    
    <%= render partial: 'share/student-history', locals: {variable: e} %>
  </div>



  <% elsif e.class.name == "Message" %>
  
  <div class="teacher_card">
    <div class="teacher_card_info">
      <div class="teacher_card_info_img">
        <% if e.teacher.present? %>
          <% if e.teacher.image.present? %>
            <%=image_tag e.teacher.image.url , class: "teacher_card_info_img_self" %>
          <% else %>
            <p class="stu_card_info_img_self" style="font-size: 14px;">画像<br>なし</p>
          <% end %>
        <% else %>
          <div></div>
        <% end %>
      </div>
      <div class="teacher_card_info_name">
        <% if e.teacher.id == @current_teacher&.id %>
          <h5>
            <%= e.teacher.full_name %>先生
            <%= link_to "削除", "/messages/#{e.id}", method: :delete, style: "color: tomato;margin-left: 40px;font-size:13px;", data: { confirm: '削除しますか？' } %>
          </h5>
        <% else %>
          <h5><%= e.teacher.full_name %>先生</h5>
        <% end %>
      </div>
      <div class="teacher_card_info_time_ago">
        <p><%= e.created_at.to_s(:datetime_jp) %></p>
      </div>
    </div>
    <div class="balloon_teacher">
      <div class="teacher_card_comment">
      <% if @current_student.present? %>
        <p><%= e.comment %></p>
      <% else %>
        <p style="font-size: 11px;">To: <%= e.student.full_name %>君</p>
        <p><%= e.comment %></p>
      <% end %>
      </div>
    </div>
  </div>


  <% else %>
  <div class="stu_card">
    <div class="stu_card_info" style="margin-bottom: 20px;">
      <div class="stu_card_info_img">
        <% if e[:results].last.student.image.present? %>
          <%= image_tag e[:results].last.student.image.url, class: "stu_card_info_img_self" %>
        <% else %>
          <p class="stu_card_info_img_self" style="font-size: 14px;">画像<br>なし</p>
        <% end %>
      </div>
      <div class="stu_card_info_name">
          <h5>
            <%= e[:results].last.student.full_name %>
          </h5>
      </div>
      <div class="stu_card_info_time_ago">
        <p style="margin-bottom: 5px;">
          <%= e[:created_at].to_s(:datetime_jp) %>
        </p>
      </div>
    </div>
    <% if e[:class][:name] = "WordTest" %>
      <div class="balloon" style="margin-top: 0px;">
        <div class="stu_card_content">
          <div class="stu_card_content_subject">
              <p class="stu_card_content_words_circle" style="margin-bottom: 5px">単</p>
          </div>
          <div class="stu_card_words" style="padding-left: 10px;">
            <p style="font-size: 12px;margin-bottom: 2px;">
              教材： <%= e[:results].last.word.wordbook.name %>
            </p>
            <div>
            <p style="font-size: 12px;margin-bottom: 5px;">
              レベル: <%= e[:results].last.word.level %>
            </p>
            </div>
          </div>
        </div>
        <div style="text-align: center;padding-right: 20px;">
          <span style="font-size: 12px;margin-bottom: 2px;margin-right: 5px;">
            <%= e[:results].length %>問中
          </span>
          <span style="font-size: 17px;margin-bottom: 5px;">
            <%= e[:results].corrects_count %>問正解
          </span>
        </div>
        <div class="stu_card_content_words" style="text-align: left;">
          <button class="btn btn-primary"
          data-toggle="collapse"
          data-target="#example-<%= e[:index] %>"
          aria-expand="false"
          aria-controls="example-<%= e[:index] %>">回答の詳細はこちら</button>
          <div class="collapse" id="example-<%= e[:index] %>">
            <div class="card card-body" style="padding: 10px;">
              <table class="table table-bordered" style="margin-bottom: 0px;">
                <thead>
                  <tr>
                    <th scope="col"><p style="font-size: 12px; margin-bottom: 0px;">No.</p></th>
                    <th scope="col" style="font-size: 12px">英単語</th>
                    <th scope="col" style="font-size: 12px">日本語</th>
                    <th class="wrong_count" scope="col" style="font-size: 9px">間違えた<br>回数</th>
                  </tr>
                </thead>
                <tbody>
                  <% e[:results].each_with_index do |r, i| %>
                  <% if r.correct %>
                    <tr>
                  <% else %>
                    <tr class= "wrong-correct-word" style="color:red;">
                  <% end %>
                      <th scope="row" style="font-size: 5px; margin-bottom: 0px;"><%= i+1 %></th>
                      <td style="font-size: 11px; margin-bottom: 0px;"><%=r.word.english %></td>
                      <td style="font-size: 11px; margin-bottom: 0px;"><%=r.word.japanese %></td>
                      <td style="font-size: 11px; text-align: ceneter;"><%=r.word.wrong_count %></td>
                    </tr> 
                  <% end %>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    <% else %>
      <div class="balloon" style="margin-top: 0px;">
        <div class="stu_card_content">
          <div class="stu_card_content_subject">
              <p class="stu_card_content_words_circle" style="margin-bottom: 5px">単</p>
          </div>
          <div class="stu_card_words" style="padding-left: 10px;">
            <p style="font-size: 12px;margin-bottom: 2px;">
              教材： <%= e[:results].last.old_word.old_wordbook.name %>
            </p>
          </div>
        </div>
        <div style="text-align: center;padding-right: 20px;">
          <span style="font-size: 12px;margin-bottom: 2px;margin-right: 5px;">
            <%= e[:results].length %>問中
          </span>
          <span style="font-size: 17px;margin-bottom: 5px;">
            <%= e[:results].corrects_count %>問正解
          </span>
        </div>
        <div class="stu_card_content_words" style="text-align: left;">
          <button class="btn btn-primary"
          data-toggle="collapse"
          data-target="#example-<%= e[:index] %>"
          aria-expand="false"
          aria-controls="example-<%= e[:index] %>">回答の詳細はこちら</button>
          <div class="collapse" id="example-<%= e[:index] %>">
            <div class="card card-body" style="padding: 10px;">
              <table class="table table-bordered" style="margin-bottom: 0px;">
                <thead>
                  <tr>
                    <th scope="col"><p style="font-size: 12px; margin-bottom: 0px;">No.</p></th>
                    <th scope="col" style="font-size: 12px">古文単語</th>
                    <th scope="col" style="font-size: 12px">漢字</th>
                    <th scope="col" style="font-size: 12px">意味</th>
                    <th class="wrong_count" scope="col" style="font-size: 9px">間違えた<br>回数</th>
                  </tr>
                </thead>
                <tbody>
                  <% e[:results].each_with_index do |r, i| %>
                  <% if r.correct %>
                    <tr>
                  <% else %>
                    <tr class= "wrong-correct-word" style="color:red;">
                  <% end %>
                      <th scope="row" style="font-size: 5px; margin-bottom: 0px;"><%= i+1 %></th>
                      <td style="font-size: 11px; margin-bottom: 0px;"><%=r.old_word.name %></td>
                      <td style="font-size: 11px; margin-bottom: 0px;"><%=r.old_word.kanji %></td>
                      <td style="font-size: 11px; margin-bottom: 0px;"><%=r.old_word.meaning %></td>
                      <td style="font-size: 11px; text-align: ceneter;"><%=r.old_word.wrong_count %></td>
                    </tr> 
                  <% end %>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>

  <% end %>

<% end%>
  <% if @current_teacher %>
    <div class="new_message_add">
    <a href="/messages/new" class="new_message_add_btn">
    <i class="fas fa-comment message_icon"></i>
    </a>
    </div>
  <% else %>
    <div class="new_question_add">
      <a href="/questions/new" class="new_message_add_btn">
        <i class="far fa-hand-paper question_icon"></i>
        <!-- <i class="fas fa-question question_icon"></i> -->
      </a>
    </div>
    <div class="new_message_add">
    <a href="/new_lh" class="new_message_add_btn">
      <i class="fas fa-pencil-alt message_icon"></i>
    </a>
    </div>
  <% end %>
  <div class="pagenation">
    <%= paginate @news %>
  </div>
</section>